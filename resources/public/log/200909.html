<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="content-type" content="text/html" charset="utf-8">
<link rel="stylesheet" href="diary.css" type="text/css">
<title>2009-09</title>
</head>
<body>
<h1 class="diary_month">2009-09</h1>
<hr>
<a href="./" class="diary">戻る</a>
<hr>
<a name="01"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-01T18:29:34 (Tue)</h2>
<h2 class="diary_title">ずっと帰省してたんよ</h2>
<div class="diary_body">
21 日に北海道へ行って，23 日に岡山へ行ってそのまま徳島に帰って，30 日まで徳島でダラダラしてました．本当にダラダラ．<br>
<br>
ゲーム製作もドン詰まって本当に酷い帰省でした orz<br>
<br>
やったことと言えば，<br>
<br>
・酷道 439 号線の京柱峠を攻略<br>
・おおかみかくし読破<br>
・ドリームクラブ開始<br>
<br>
くらい．<br>
<br>
ドリクラは 28 日にとある方の実況プレイ動画配信を見て購入を決意ｗ　品薄状態になっているのを懸念して念のためにソフトだけを徳島で確保し，そして 1 日に関東へ戻ってきてから台風の中ヨドバシに行って箱○を確保しました．<br>
<br>
あとそこでついでにヨドバシカメラのクレジットカードも申し込み．人生 3 枚目のクレカです．1 枚目の Citi カードは年会費が掛かるようになるのでもうすぐ解約するとして，2 枚目の三菱東京 UFJ 銀行のカードもポイントや特典がショボいのでそろそろ見切りをつけます．<br>
<br>
帰省時にサモにクレジットカードを作るよう促して (Xbox Live や DLC や Amazon での買い物が楽になるよ，ってことで) ヤマダ電機のカードを申し込みするように言ったので，自分も勢いづいてヨドバシで申し込みをしたというわけです (あんまり因果関係無いとか言わない)．<br>
<br>
やっぱり今の時代クレカは 1 枚は持っておくと何かと便利ですよ，えぇ．うちもプロバイダの料金はカードじゃないと払えませんでしたし，ETC も使えませんし…　何より Amazon での買い物が (^^;<br>
</div>
</div>
<a name="02"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-02T21:46:02 (Wed)</h2>
<h2 class="diary_title">らき☆すた神輿が本気過ぎる</h2>
<div class="diary_body">
<a href="http://www.saitama-np.co.jp/news09/01/03l.html" target="_blank">「らき☆すた神輿」お目見え　鷲宮神社通り　6日の「土師祭」</a><br>
<br>
こーちゃん先輩，宮川姉妹，永森のやまとさんまで居るとは，よくやりましたね！ ＞∀＜<br>
<br>
見に行きたいですがあいにくコミトレなので行けません．ガックシ orz<br>
</div>
</div>
<a name="04"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-04T06:09:13 (Fri)</h2>
<h2 class="diary_title">ラブプラスを買った</h2>
<div class="diary_body">
一応入手しましたです，ハイ．<br>
<br>
ヨドバシ特価で約 4,800 円おいしいです ^q^<br>
<br>
まだ友達パートですが，恋人パートにならないと恐ろしく単調なゲームですな…これ…<br>
<br>
ドリクラもまったりプレイ中ですが，急がないと再来週にはアイマス DS とサガ 2 が発売されてしまう (・ω・)<br>
</div>
</div>
<a name="06"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-06T23:04:04 (Sun)</h2>
<h2 class="diary_title">少女漫画雑誌「なかよし」にて『アイドルマスターDS』特集が載る</h2>
<div class="diary_body">
<a href="http://blog.livedoor.jp/jin115/archives/51563215.html" target="_blank">少女漫画雑誌「なかよし」にて『アイドルマスターDS』特集が載る</a><br>
<br>
日本の少女たちオワタｗｗｗｗ＼(^o^)／<br>
<br>
少女的には女装少年 (涼ちんこ) はアリなのか…？<br>
</div>
</div>
<a name="07"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-07T22:13:59 (Mon)</h2>
<h2 class="diary_title">多重債務の恐怖</h2>
<div class="diary_body">
<a href="http://hamusoku.com/archives/89466.html" target="_blank">お前ら、借金だけは絶対するなよ。 (ハムスター速報　２ろぐ)</a><br>
<br>
少し前にも消費者金融の金利や多重債務者のことは問題になりましたなぁ．<br>
<br>
そのときにニュースで聞いたことですが，多重債務に陥った人を救うために絶対にしなければならないことが「必ず『全ての』借金を聞き出すこと」だそうです．一件たりとも残してはいけない，と．<br>
<br>
このメルマガの最後の内容のネタバレになりますが，本当にそうなんだね…と… (--;<br>
</div>
</div>
<a name="07"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-07T22:19:47 (Mon)</h2>
<h2 class="diary_title">ラブプラスぼちぼち進めてます</h2>
<div class="diary_body">
まだリアルタイムモードには手を出していませんｗ<br>
<br>
これをやり出すと本当に (リアルの) 手帳に「週末はデート…と…」とか書き始めるらしいですねｗ<br>
<br>
とりあえず姉ヶ崎先輩とお付き合いを開始しました．開始までに掛かった時間は 75 日．もっと短くは出来ないのかねこれ？<br>
<br>
さて，それでは現在流行っているという「彼女とドリームクラブへ行く」という遊びを行うとしますかｗｗｗｗ<br>
<br>
※関連<br>
<a href="http://blog.livedoor.jp/insidears/archives/52019225.html" target="_blank">ラブプラス が本日発売されました。 (【2ch】ニュー速VIPブログ(`・ω・´))</a><br>
</div>
</div>
<a name="11"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-11T15:24:13 (Fri)</h2>
<h2 class="diary_title">「らき☆すた」が埼玉を紹介　10月8日別刷り特集発行</h2>
<div class="diary_body">
<a href="http://www.saitama-np.co.jp/news09/10/01x.html" target="_blank">「らき☆すた」が埼玉を紹介　10月8日別刷り特集発行 (Web 埼玉)</a><br>
<br>
>特集では、主人公の「泉こなた」「柊かがみ・つかさ」姉妹らが、県内の新名所やＢ級グルメを紹介。<br>
<br>
みゆきさん… (´；ω；`)<br>
</div>
</div>
<a name="12"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-12T04:39:56 (Sat)</h2>
<h2 class="diary_title">DX ライブラリの printfDx を Squirrel 側から使う</h2>
<div class="diary_body">
Squirrel の print 関数を DX ライブラリの printfDx に対応させる方法です．<br>
<br>
可変長引数で受け取ったものをそのまま printfDx へ可変長引数として渡すことが出来ないので，一度 vsprintf という関数を挟みます．<br>
<br>
<blockquote>#include &lt;DxLib.h&gt;<br>
#include &lt;cstdio&gt;<br>
#include &lt;cstdarg&gt;<br>
<br>
/** 文字列表示用関数 */<br>
#pragma warning (disable : 4100) //引数の未使用に対する警告を無視<br>
#pragma warning (disable : 4996) //vsprintf の使用に対する警告を無視<br>
void print(HSQUIRRELVM v, const SQChar* s, ...)<br>
{<br>
　char buf[4096]; //適当に大きく取っておく<br>
　va_list arglist;<br>
　va_start(arglist, s);<br>
　vsprintf(buf, s, arglist);<br>
　::printfDx(buf);<br>
　va_end(arglist);<br>
}<br>
</blockquote><br>
どこかで以下を実行して print 関数として登録．<br>
<br>
<blockquote>::sq_setprintfunc(v, print);<br>
</blockquote><br>
こうすると Squirrel スクリプト側から画面に簡単に文字列を表示出来るようにもなるのでオススメだと思います．また，後で紹介しますが sqstd_printcallstack というデバッグにおいて非常に便利な関数も使えるようになります．<br>
<br>
続き : <a href="http://kaosf.kirara.st/sb/log/eid251.html" target="_blank">sqstd_printcallstack がとっても便利</a><br>
</div>
</div>
<a name="13"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-13T00:23:12 (Sun)</h2>
<h2 class="diary_title">sqstd_printcallstack がとっても便利</h2>
<div class="diary_body">
Squirrel に付属している簡易インタプリタ sq.exe で Squirrel スクリプトを動かしたとき，実行時エラーが発生するとコードのどこを実行した際にエラーが出たのか，またそのときローカル変数がどうだったのかが見られます．<br>
<br>
これをゲームに組み込んだ際にも見られるようにしましょう (^ω^)<br>
<br>
実行時エラーが起こった際にそれを捕捉する方法も交えて紹介します．<br>
<br>
まず，次のようなエラーハンドラと呼ばれる関数を作ります．<br>
<br>
<blockquote>/** エラーハンドラ */<br>
#pragma warning (disable : 4702) //return 文への未到達に対する警告を無視<br>
SQInteger handleError(HSQUIRRELVM v)<br>
{<br>
　//エラー発生時にはスタックの -1 番目にエラー情報，-2 番目に table (※何かは未調査) …となっている．<br>
　const SQChar* desc;<br>
　::sq_getstring(v, -1, &desc);<br>
　char errorMsg[1024]; //適当に大きくとっておく<br>
　sprintf_s(errorMsg, 1024, "%s", desc);<br>
　::sqstd_printcallstack(v);<br>
　::ScreenFlip(); //こうすることで強制的に表示<br>
　MessageBox(NULL, errorMsg, "実行時エラー", MB_OK | MB_ICONEXCLAMATION);<br>
　::exit(1);<br>
　return 0;<br>
}<br>
</blockquote><br>
後は次のようなコードを実行してやれば，実行時エラーが発生したときにエラーハンドラが実行されるようになります．<br>
<br>
<blockquote>//エラーハンドラ設定<br>
//v は SQUIRRELVM<br>
::sq_pushroottable(v); //関数を登録するルートテーブルをスタックに積む<br>
::sq_pushstring(v, _SC("___MyErrorHandler"), -1); //関数名をキーとしてスタックに積む<br>
::sq_newclosure(v, handleError, 0); //新規関数を作成<br>
::sq_newslot(v, -3, SQFalse); //ルートテーブルの新規スロットに関数をセットする<br>
::sq_pop(v, 1); //ルートテーブルの除去<br>
::sq_pushroottable(v); //関数の探索対象テーブル設定する (今回はルートテーブル)<br>
::sq_pushstring(v, _SC("___MyErrorHandler"), -1); //関数名 (キー) の設定<br>
::sq_get(v, -2); //関数のフェッチ，フェッチした関数のスタックへの push<br>
::sq_seterrorhandler(v); //push した関数をエラーハンドラとして設定<br>
::sq_pop(v, 1); //ルートテーブルを除去<br>
</blockquote><br>
色々面倒ですがエラーハンドラの辺りは色々と個性やらアイディアやらを出せそうな感じがするところではあります．即終了とか芸がないよね，とは思いますが私は面倒なのでとりあえずこのままでｗ<br>
<br>
ちなみに，7 行目と 8 行目にルートテーブルを pop してまた push して…という動作がありますが，これは 7 行目までの処理が「関数をバインドする」という一連の動作であり，それをコピペしただけなのでこうなっています．<br>
<br>
実際，私の開発環境では最初の pushroottable から 7 行目までの処理を<br>
<br>
<blockquote>/**<br>
 * C/C++ の関数をバインドする&lt;br /&gt;<br>
 * (C/C++ の関数を Squirrel VM に登録する (ルートテーブルに登録する))<br>
 * @param v Squirrel VM<br>
 * @param f 登録する関数の関数ポインタ<br>
 * @param fname 関数名<br>
 */<br>
void bindFunction(HSQUIRRELVM v, SQFUNCTION f, const SQChar* fname)<br>
{<br>
　::sq_pushroottable(v); //関数を登録するルートテーブルをスタックに積む<br>
　::sq_pushstring(v, fname, -1); //関数名をキーとしてスタックに積む<br>
　::sq_newclosure(v, f, 0); //新規関数を作成<br>
　::sq_newslot(v, -3, SQFalse); //ルートテーブルの新規スロットに関数をセットする<br>
　::sq_pop(v, 1); //ルートテーブルの除去<br>
}<br>
</blockquote><br>
という風にサブルーチンに分けています．<br>
</div>
<h3 class="diary_comment_header">comments</h3>
<div class="diary_comment">
<h3 class="diary_comment_author"> (2009-10-30T13:17:02)</h3>
<div class="diary_comment_body">
こちらでは、はじめてのコメント。<br>
<br>
手抜きをするなら sqstd_seterrorhandlers がさらに優秀です。<br>
エラー処理は、sqstdaux.cpp あたりのソースを参考にするとよさげかも。<br>
</div>
<h3 class="diary_comment_author">か (2009-10-30T21:44:10)</h3>
<div class="diary_comment_body">
コメントどうもです．<br>
<br>
sqstdaux.cpp の最後の方ですね．読んでみました．<br>
<br>
私程度が思いつく事は既に標準で用意されていたということか…ｗｗ<br>
</div>
</div>
</div>
<a name="17"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-17T20:28:50 (Thu)</h2>
<h2 class="diary_title">アイマス DS とサガ 2 購入</h2>
<div class="diary_body">
本日発売のアイマス DS とサガ 2 を買ってきました．それでもういっそのこと，と思って DSi 本体も一緒に買いました．合計 3 万円おいしいです ^q^　いいさいいさ…ヨドバシポイントがまた 2000pt くらい溜まったし… (´ω`)<br>
<br>
ちなみに「狼と香辛料 海を渡る風」も本日発売で，ヨドバシでもプロモーションビデオが流れていました．それで凄く気になったのですがさすがに 3 本は買えない…　それに商売シミュレーションは大航海時代 4 で楽しんでるので，しばらくは様子見です．<br>
<br>
ちなみに DSi 購入により，我が家には DS が初代から全て揃ったことに．<br>
<br>
[追記]<br>
<br>
アイマス DS，どうやら「予約特典」でヴァイスシュヴァルツの PR カードが付いてたようです…<br>
<br>
今後から予約特典は特に気を付けようと心に誓いました．初回特典ならどうにかなる可能性はあるけど予約だけは取り返しが付かないので．<br>
<br>
…いや，カードそのものが欲しいならカードショップで手に入れればいいわけですが，私が欲しかったのはそのカードを売った利益 ^q^　らき☆すたデッキ以外は組まないので不要なのです ^q^<br>
</div>
</div>
<a name="30"></a>
<div class="diary">
<h2 class="diary_date_header">2009-09-30T06:10:13 (Wed)</h2>
<h2 class="diary_title">インフルにかかってました</h2>
<div class="diary_body">
シルバーウィークの最終日にとうとうインフルエンザにかかってしまい，そこから昨日までずっと寝てました．熱は下がったんですが咳と痰と鼻水がまだ止まりません．<br>
<br>
とりあえずこのままいくと 9 月終わっちゃいそうなので TODO リストだけでも…<br>
<br>
・新潟遠征記<br>
<br>
リストっつってもまぁこれだけですがｗ　9 月 19 日，シルバーウィークの初日に ohrin とサモとで新潟に行ってきました．交通手段は ohrin の車．何をして来たかって言うといわゆる聖地巡礼．今週末には書き上げようと思います．<br>
</div>
</div>
<hr>
<a href="./">戻る</a>
<hr>
</body>
</html>
